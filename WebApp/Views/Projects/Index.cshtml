@model WebApp.ViewModels.ProjectsIndexVm

@section Styles {
    <link rel="stylesheet" href="~/css/components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/pages/projects.css" asp-append-version="true" />
}

@{
    ViewData["Title"] = "Alla projekt";
}

<div class="projects-page">
    <div class="projects-banner" aria-label="Projects-banner">
        <img src="~/images/bannersandicons/allaprojekt.png" alt="Banner" class="projects-banner-img" />
    </div>

    <div class="projects-container">
        <div class="projects-shell">
            <div class="projects-topbar">
                <div>
                    <h1 class="projects-title">Alla projekt</h1>
                    <div class="projects-sub">Skapa, hitta och gå med i projekt</div>
                </div>

                <div class="projects-topbar-actions">
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <a class="btn-primary-custom" href="@Url.Action("Create", "Projects")">Skapa projekt</a>
                    }
                </div>
            </div>

            @if (Model.ShowLoginTip)
            {
                <div class="projects-tip">Tips: Du får fler resultat om du är inloggad!</div>
            }

            <div class="projects-controls">
                <form method="get" class="projects-search">
                    @if (!string.IsNullOrWhiteSpace(Model.FilterUserId))
                    {
                        <input type="hidden" name="userId" value="@Model.FilterUserId" />
                    }
                    <div class="projects-search-main">
                        <input class="projects-input" type="text" name="q" value="@Model.Query" placeholder="Sök…" />

                        <div class="projects-segmented" role="group" aria-label="Sök i">
                            <label class="seg-item">
                                <input type="radio" name="scope" value="all" checked="@(Model.Scope == "all")" />
                                <span>Alla</span>
                            </label>
                            <label class="seg-item">
                                <input type="radio" name="scope" value="title" checked="@(Model.Scope == "title")" />
                                <span>Titel</span>
                            </label>
                            <label class="seg-item">
                                <input type="radio" name="scope" value="created" checked="@(Model.Scope == "created")" />
                                <span>Skapad av</span>
                            </label>
                            <label class="seg-item">
                                <input type="radio" name="scope" value="member" checked="@(Model.Scope == "member")" />
                                <span>Medlem i</span>
                            </label>
                        </div>
                    </div>

                    <div class="projects-search-right">
                        <label class="projects-toggle" title="Visar bara projekt du skapat">
                            <input type="checkbox" name="mine" value="true" checked="@Model.OnlyMine" @(User.Identity?.IsAuthenticated == true ? "" : "disabled") />
                            <span class="toggle-ui" aria-hidden="true"></span>
                            <span>Visa bara mina</span>
                        </label>

                        <select class="projects-input" name="sort" aria-label="Sortering">
                            <option value="new" selected="@(Model.Sort == "new")">Senast skapade</option>
                            <option value="old" selected="@(Model.Sort == "old")">Äldst först</option>
                            <option value="az" selected="@(Model.Sort == "az")">A-Ö</option>
                            <option value="za" selected="@(Model.Sort == "za")">Ö-A</option>
                        </select>

                        <button type="submit" class="btn-secondary-custom">Sök</button>
                    </div>
                </form>
            </div>

            <div class="projects-list-card">
                <div class="projects-grid">
                    @if (Model.Projects.Count == 0)
                    {
                        <div class="projects-empty">Inga projekt hittades.</div>
                    }
                    else
                    {
                        foreach (var p in Model.Projects)
                        {
                            <a class="projects-card" href="@Url.Action("Details", "Projects", new { id = p.Id })">
                                <div class="projects-doc">
                                    <div class="projects-doc-top">
                                        <div class="projects-doc-grid">
                                            <div class="projects-doc-avatar" aria-hidden="true">
                                                <img src="@(string.IsNullOrWhiteSpace(p.ImagePath) ? "/images/projects/rocketship.png" : p.ImagePath)" alt="" />
                                            </div>

                                            <div class="projects-doc-center">
                                                <div class="projects-doc-title">@p.Title</div>
                                                <div class="projects-doc-createdby">
                                                    Skapare: @(string.IsNullOrWhiteSpace(p.CreatedByName) ? (p.CreatedByEmail ?? "Okänd") : p.CreatedByName)
                                                </div>
                                                <div class="projects-doc-meta">Skapad: @p.CreatedUtc.ToString("yyyy-MM-dd")</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="projects-doc-body">
                                        @if (!string.IsNullOrWhiteSpace(p.ShortDescription))
                                        {
                                            <div class="projects-doc-desc-card">
                                                <div class="projects-doc-desc">@p.ShortDescription</div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="projects-doc-desc-card">
                                                <div class="projects-doc-desc projects-doc-desc--muted">Ingen kort beskrivning.</div>
                                            </div>
                                        }

                                        @if (!string.IsNullOrWhiteSpace(p.TechKeysCsv))
                                        {
                                            <div class="projects-doc-bottom">
                                                <div class="projects-doc-sep" aria-hidden="true"></div>
                                                <div class="projects-doc-tech" aria-label="Tech stack">
                                                    @foreach (var key in p.TechKeysCsv.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries))
                                                    {
                                                        <span class="projects-doc-tech-tile">
                                                            <img class="projects-doc-tech-icon" src="~/images/svg/techstack/@(key).svg" alt="@key" />
                                                        </span>
                                                    }
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                             </a>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>
